import pandas as pd
import matplotlib.pyplot as plt

# Save the provided financial data to a temporary CSV file
data = """
,Country Name,Country Code,Series Name,Series Code,1960 [YR1960],1961 [YR1961],1962 [YR1962],1963 [YR1963],1964 [YR1964],1965 [YR1965],1966 [YR1966],1967 [YR1967],1968 [YR1968],1969 [YR1969],1970 [YR1970],1971 [YR1971],1972 [YR1972],1973 [YR1973],1974 [YR1974],1975 [YR1975],1976 [YR1976],1977 [YR1977],1978 [YR1978],1979 [YR1979],1980 [YR1980],1981 [YR1981],1982 [YR1982],1983 [YR1983],1984 [YR1984],1985 [YR1985],1986 [YR1986],1987 [YR1987],1988 [YR1988],1989 [YR1989],1990 [YR1990],1991 [YR1991],1992 [YR1992],1993 [YR1993],1994 [YR1994],1995 [YR1995],1996 [YR1996],1997 [YR1997],1998 [YR1998],1999 [YR1999],2000 [YR2000],2001 [YR2001],2002 [YR2002],2003 [YR2003],2004 [YR2004],2005 [YR2005],2006 [YR2006],2007 [YR2007],2008 [YR2008],2009 [YR2009],2010 [YR2010],2011 [YR2011],2012 [YR2012],2013 [YR2013],2014 [YR2014],2015 [YR2015],2016 [YR2016],2017 [YR2017],2018 [YR2018],2019 [YR2019],2020 [YR2020],2021 [YR2021],2022 [YR2022],2023 [YR2023]
0,Pakistan,PAK,Account ownership at a financial institution or with a mobile-money-service provider (% of population ages 15+),FX.OWN.TOTL.ZS,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,16.405,10.31,16.405,16.405,13.04,16.405,16.405,21.29,16.405,16.405,16.405,20.98,16.405,16.405
1,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, female (% of population ages 15+)",FX.OWN.TOTL.FE.ZS,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,7.075,2.95,7.075,7.075,4.84,7.075,7.075,7.03,7.075,7.075,7.075,13.48,7.075,7.075
2,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, male (% of population ages 15+)",FX.OWN.TOTL.MA.ZS,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,25.259999999999998,17.28,25.259999999999998,25.259999999999998,20.97,25.259999999999998,25.259999999999998,34.61,25.259999999999998,25.259999999999998,25.259999999999998,28.18,25.259999999999998,25.259999999999998
3,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, older adults (% of population ages 25+)",FX.OWN.TOTL.OL.ZS,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,17.8825,11.45,17.8825,17.8825,12.96,17.8825,17.8825,24.58,17.8825,17.8825,17.8825,22.54,17.8825,17.8825
4,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, poorest 40% (% of population ages 15+)",FX.OWN.TOTL.40.ZS,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,11.5975,4.81,11.5975,11.5975,9.75,11.5975,11.5975,14.22,11.5975,11.5975,11.5975,17.61,11.5975,11.5975
5,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, primary education or less (% of population ages 15+)",FX.OWN.TOTL.PL.ZS,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,11.252500000000001,3.75,11.252500000000001,11.252500000000001,10.03,11.252500000000001,11.252500000000001,15.92,11.252500000000001,11.252500000000001,11.252500000000001,15.31,11.252500000000001,11.252500000000001
6,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, richest 60% (% of population ages 15+)",FX.OWN.TOTL.60.ZS,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,19.59,13.94,19.59,19.59,15.21,19.59,19.59,26.0,19.59,19.59,19.59,23.21,19.59,19.59
7,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, secondary education or more (% of population ages 15+)",FX.OWN.TOTL.SO.ZS,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,29.744999999999997,24.46,29.744999999999997,29.744999999999997,25.19,29.744999999999997,29.744999999999997,34.03,29.744999999999997,29.744999999999997,29.744999999999997,35.3,29.744999999999997,29.744999999999997
8,Pakistan,PAK,"Account ownership at a financial institution or with a mobile-money-service provider, young adults (% of population ages 15-24)",FX.OWN.TOTL.YG.ZS,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,13.535,7.95,13.535,13.535,13.2,13.535,13.535,14.89,13.535,13.535,13.535,18.1,13.535,13.535
"""

with open('temp_financial_data.csv', 'w') as f:
    f.write(data)

# Read CSV using read_csv
df = pd.read_csv('temp_financial_data.csv')

# Filter for the six selected indicators
indicators = [
    'FX.OWN.TOTL.FE.ZS',  # Female
    'FX.OWN.TOTL.MA.ZS',  # Male
    'FX.OWN.TOTL.OL.ZS',  # Older adults
    'FX.OWN.TOTL.40.ZS',  # Poorest 40%
    'FX.OWN.TOTL.60.ZS',  # Richest 60%
    'FX.OWN.TOTL.YG.ZS'   # Young adults
]
df_filtered = df[df['Series Code'].isin(indicators)]

# Select years with actual data
years = ['2011 [YR2011]', '2014 [YR2014]', '2017 [YR2017]', '2021 [YR2021]']
df_filtered = df_filtered[['Series Name'] + years]

# Convert to numeric
for col in years:
    df_filtered[col] = pd.to_numeric(df_filtered[col], errors='coerce')

# Pivot data
df_pivot = df_filtered.set_index('Series Name')[years].T
df_pivot.index = [int(col.split()[0]) for col in df_pivot.index]
df_pivot.columns = [
    'Female', 'Male', 'Older Adults', 'Poorest 40%', 'Richest 60%', 'Young Adults'
]

# Normalize values to sum to 100 for stacking
df_normalized = df_pivot.copy()
for year in df_pivot.index:
    total = df_pivot.loc[year].sum()
    if total > 0:
        df_normalized.loc[year] = (df_pivot.loc[year] / total) * 100
    else:
        df_normalized.loc[year] = 0

# Plot stacked bar
plt.figure(figsize=(10, 6))
bottom = None
colors = ['pink', 'lightblue', 'lightgreen', 'orange', 'purple', 'yellow']
for i, column in enumerate(df_normalized.columns):
    plt.bar(df_normalized.index, df_normalized[column], bottom=bottom, label=column, color=colors[i])
    if bottom is None:
        bottom = df_normalized[column]
    else:
        bottom += df_normalized[column]

# Customize plot
plt.title('Account Ownership by Demographic in Pakistan (2011–2021)')
plt.xlabel('Year')
plt.ylabel('Normalized Account Ownership (%)')
plt.legend()
plt.xticks(df_normalized.index)
plt.grid(True, axis='y', linestyle='--', alpha=0.7)
plt.tight_layout()

# Save and show
plt.savefig('account_ownership_stacked_bar.png')
plt.show()